<!DOCTYPE html>
<html>
<head>
    <title>PDF Editor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .page-controls {
            margin: 20px 0;
            text-align: center;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .page-container {
            position: relative;
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .text-box {
            position: absolute;
            cursor: pointer;
            border: 1px solid transparent;
            transition: all 0.2s;
        }
        .text-box:hover {
            background: rgba(255,0,0,0.2);
            border: 1px solid red;
        }
        button {
            padding: 8px 16px;
            margin: 0 5px;
            border: none;
            border-radius: 4px;
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        #current-page {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="page-controls">
            <button onclick="prevPage()">Previous</button>
            <span id="page-num">1</span> / <span id="page-total">1</span>
            <button onclick="nextPage()">Next</button>
        </div>
        <div id="page-container" class="page-container">
            <img id="current-page" src="" alt="PDF Page" />
            <div id="text-overlay"></div>
        </div>
    </div>
    <script>
        let currentPage = 1;
        let totalPages = 1;
        let textData = {};

        async function loadTextData() {
            try {
                const response = await fetch('/text_data');
                textData = await response.json();
                updatePage();
            } catch (error) {
                console.error('Error loading text data:', error);
            }
        }


        async function loadPages() {
            try {
                const response = await fetch('/pages');
                const pages = await response.json();
                totalPages = pages.length;
                document.getElementById('page-total').textContent = totalPages;
                updatePage();
            } catch (error) {
                console.error('Error loading pages:', error);
            }
        }

        async function deleteTextBox(textId) {
            if (confirm('Delete this text box?')) {
                try {
                    const response = await fetch('/delete_text', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            page: `page_${currentPage.toString().padStart(3, '0')}`,
                            text_id: textId
                        })
                    });
                    if (response.ok) {
                        await loadTextData();
                    } else {
                        console.error('Failed to delete text box');
                    }
                } catch (error) {
                    console.error('Error deleting text box:', error);
                }
            }
        }

        function updatePage() {
            const pageId = `page_${currentPage.toString().padStart(3, '0')}`;
            document.getElementById('current-page').src = `/images/${pageId}.png`;
            document.getElementById('page-num').textContent = currentPage;
            updateTextOverlay(pageId);
        }

        function updateTextOverlay(pageId) {
            const overlay = document.getElementById('text-overlay');
            overlay.innerHTML = '';

            if (textData.text && textData.text[pageId]) {
                const pageTexts = textData.text[pageId];
                pageTexts.forEach((text, index) => {
                    const div = document.createElement('div');
                    div.className = 'text-box';
                    div.style.left = `${text.bbox[0]}px`;
                    div.style.top = `${text.bbox[1]}px`;
                    div.style.width = `${text.bbox[2] - text.bbox[0]}px`;
                    div.style.height = `${text.bbox[3] - text.bbox[1]}px`;
                    div.title = text.text;
                    div.onclick = () => deleteTextBox(index);
                    overlay.appendChild(div);
                });
            }
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                updatePage();
            }
        }

        function nextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                updatePage();
            }
        }

        // Initialize
        loadPages();
        loadTextData();
    </script>
</body>
</html>
